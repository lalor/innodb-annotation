<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>InnoDB Plugin: rw_lock_t Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">InnoDB Plugin
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">rw_lock_t Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="sync0rw_8h_source.html">sync0rw.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for rw_lock_t:</div>
<div class="dyncontent">
<div class="center"><img src="structrw__lock__t__coll__graph.png" border="0" usemap="#rw__lock__t_coll__map" alt="Collaboration graph"/></div>
<map name="rw__lock__t_coll__map" id="rw__lock__t_coll__map">
<area shape="rect" id="node13" href="structut__list__node.html" title="ut_list_node\&lt; rw_lock_t \&gt;" alt="" coords="1115,175,1301,203"/><area shape="rect" id="node2" href="structos__event.html" title="os_event" alt="" coords="275,174,355,202"/><area shape="rect" id="node4" href="structut__list__node.html" title="ut_list_node\&lt; os_event_t \&gt;" alt="" coords="516,94,713,122"/><area shape="rect" id="node16" href="structib__mutex__t.html" title="ib_mutex_t" alt="" coords="568,254,661,282"/><area shape="rect" id="node7" href="structos__fast__mutex__t.html" title="os_fast_mutex_t" alt="" coords="5,223,133,251"/><area shape="rect" id="node9" href="structut__list__base.html" title="ut_list_base\&lt; rw_lock\l_debug_t \&gt;" alt="" coords="536,21,693,65"/><area shape="rect" id="node11" href="structrw__lock__debug__t.html" title="rw_lock_debug_t" alt="" coords="252,21,377,49"/><area shape="rect" id="node19" href="structut__list__node.html" title="ut_list_node\&lt; ib_mutex_t \&gt;" alt="" coords="832,295,1032,323"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a27674049fdc48cf15e5f2cf6ed7297b8"><td class="memItemLeft" align="right" valign="top">volatile lint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a27674049fdc48cf15e5f2cf6ed7297b8">lock_word</a></td></tr>
<tr class="memitem:a13331c41c505a694820ef9a5103cf331"><td class="memItemLeft" align="right" valign="top">volatile ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a13331c41c505a694820ef9a5103cf331">waiters</a></td></tr>
<tr class="memitem:ad070dd43b1e0f521cddd6a34ee136b9a"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#ad070dd43b1e0f521cddd6a34ee136b9a">recursive</a></td></tr>
<tr class="memitem:a09a9b8daf73c1c35f4d30632848df08b"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="os0thread_8h.html#a0e87ca653f4358a387e610ee5c542f74">os_thread_id_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a09a9b8daf73c1c35f4d30632848df08b">writer_thread</a></td></tr>
<tr class="memitem:aa382fc2d173f94864e88057aaa15e09b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os0sync_8h.html#ae24909be432e4a95bd956a707e4d1d20">os_event_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#aa382fc2d173f94864e88057aaa15e09b">event</a></td></tr>
<tr class="memitem:a782d7ac356b97fee7edec4681dd22391"><td class="memItemLeft" align="right" valign="top"><a class="el" href="os0sync_8h.html#ae24909be432e4a95bd956a707e4d1d20">os_event_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a782d7ac356b97fee7edec4681dd22391">wait_ex_event</a></td></tr>
<tr class="memitem:a136a4534c654942c2d24bd1960fbddcb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structib__mutex__t.html">ib_mutex_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a136a4534c654942c2d24bd1960fbddcb">mutex</a></td></tr>
<tr class="memitem:a7bde7367c58451d5108d9f04e3ad23b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structut__list__node.html">ut_list_node</a>&lt; <a class="el" href="structrw__lock__t.html">rw_lock_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a7bde7367c58451d5108d9f04e3ad23b8">list</a></td></tr>
<tr class="memitem:a3b8877f689615a4a13a6ae21c0b30d83"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structut__list__base.html">ut_list_base</a>&lt; <a class="el" href="structrw__lock__debug__t.html">rw_lock_debug_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a3b8877f689615a4a13a6ae21c0b30d83">debug_list</a></td></tr>
<tr class="memitem:a567c2bd0b3a4c14e1b1952636d133892"><td class="memItemLeft" align="right" valign="top">ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a567c2bd0b3a4c14e1b1952636d133892">level</a></td></tr>
<tr class="memitem:a37ef9818a990b7cff8d65dfac388a4f4"><td class="memItemLeft" align="right" valign="top">ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a37ef9818a990b7cff8d65dfac388a4f4">count_os_wait</a></td></tr>
<tr class="memitem:a63e6a454de925915243d64a3d2ce0730"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a63e6a454de925915243d64a3d2ce0730">cfile_name</a></td></tr>
<tr class="memitem:a73a498a7f33893e3c31d8147b1a9bd5f"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a73a498a7f33893e3c31d8147b1a9bd5f">last_s_file_name</a></td></tr>
<tr class="memitem:aaa001b622f460caca77cd274f84a5c00"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#aaa001b622f460caca77cd274f84a5c00">last_x_file_name</a></td></tr>
<tr class="memitem:ab641f9504e78011dc263e73c2435e166"><td class="memItemLeft" align="right" valign="top"><a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#ab641f9504e78011dc263e73c2435e166">writer_is_wait_ex</a></td></tr>
<tr class="memitem:abbe5bdcaddb99c722fe45aea9a1cae40"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#abbe5bdcaddb99c722fe45aea9a1cae40">cline</a>:14</td></tr>
<tr class="memitem:af1c8fb39c75f22fe02cf117fcbc5e1eb"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#af1c8fb39c75f22fe02cf117fcbc5e1eb">last_s_line</a>:14</td></tr>
<tr class="memitem:a07965f511a71db9887f00ad223c593f4"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a07965f511a71db9887f00ad223c593f4">last_x_line</a>:14</td></tr>
<tr class="memitem:a869c22d3e4661ba8f28e46ec3774f45c"><td class="memItemLeft" align="right" valign="top">ulint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrw__lock__t.html#a869c22d3e4661ba8f28e46ec3774f45c">magic_n</a></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><pre class="fragment">The structure used in the spin lock implementation of a read-write
</pre><p> lock. Several threads may have a shared lock simultaneously in this lock, but only one writer may have an exclusive lock, in which case no shared locks are allowed. To prevent starving of a writer blocked by readers, a writer may queue for x-lock by decrementing lock_word: no new readers will be let in while the thread waits for readers to exit. </p>
</div><h2>Field Documentation</h2>
<a class="anchor" id="a63e6a454de925915243d64a3d2ce0730"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* rw_lock_t::cfile_name</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>File name where lock created </p>

</div>
</div>
<a class="anchor" id="abbe5bdcaddb99c722fe45aea9a1cae40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned rw_lock_t::cline</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Line where created </p>

</div>
</div>
<a class="anchor" id="a37ef9818a990b7cff8d65dfac388a4f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulint rw_lock_t::count_os_wait</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count of os_waits. May not be accurate </p>

</div>
</div>
<a class="anchor" id="a3b8877f689615a4a13a6ae21c0b30d83"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structut__list__base.html">ut_list_base</a>&lt; <a class="el" href="structrw__lock__debug__t.html">rw_lock_debug_t</a> &gt; rw_lock_t::debug_list</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>In the debug version: pointer to the debug info list of the lock </p>

</div>
</div>
<a class="anchor" id="aa382fc2d173f94864e88057aaa15e09b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os0sync_8h.html#ae24909be432e4a95bd956a707e4d1d20">os_event_t</a> rw_lock_t::event</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Used by sync0arr.cc for thread queueing </p>

</div>
</div>
<a class="anchor" id="a73a498a7f33893e3c31d8147b1a9bd5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* rw_lock_t::last_s_file_name</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>File name where last s-locked </p>

</div>
</div>
<a class="anchor" id="af1c8fb39c75f22fe02cf117fcbc5e1eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned rw_lock_t::last_s_line</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Line number where last time s-locked </p>

</div>
</div>
<a class="anchor" id="aaa001b622f460caca77cd274f84a5c00"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* rw_lock_t::last_x_file_name</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>File name where last x-locked </p>

</div>
</div>
<a class="anchor" id="a07965f511a71db9887f00ad223c593f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned rw_lock_t::last_x_line</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Line number where last time x-locked </p>

</div>
</div>
<a class="anchor" id="a567c2bd0b3a4c14e1b1952636d133892"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulint rw_lock_t::level</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Level in the global latching order. </p>

</div>
</div>
<a class="anchor" id="a7bde7367c58451d5108d9f04e3ad23b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structut__list__node.html">ut_list_node</a>&lt; <a class="el" href="structrw__lock__t.html">rw_lock_t</a> &gt; rw_lock_t::list</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>All allocated rw locks are put into a list </p>

</div>
</div>
<a class="anchor" id="a27674049fdc48cf15e5f2cf6ed7297b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile lint rw_lock_t::lock_word</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Holds the state of the lock. </p>

</div>
</div>
<a class="anchor" id="a869c22d3e4661ba8f28e46ec3774f45c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ulint rw_lock_t::magic_n</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>RW_LOCK_MAGIC_N </p>

</div>
</div>
<a class="anchor" id="a136a4534c654942c2d24bd1960fbddcb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structib__mutex__t.html">ib_mutex_t</a> rw_lock_t::mutex</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The mutex protecting <a class="el" href="structrw__lock__t.html">rw_lock_t</a> </p>

</div>
</div>
<a class="anchor" id="ad070dd43b1e0f521cddd6a34ee136b9a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a> rw_lock_t::recursive</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default value FALSE which means the lock is non-recursive. The value is typically set to TRUE making normal rw_locks recursive. In case of asynchronous IO, when a non-zero value of 'pass' is passed then we keep the lock non-recursive. This flag also tells us about the state of writer_thread field. If this flag is set then writer_thread MUST contain the thread id of the current x-holder or wait-x thread. This flag must be reset in x_unlock functions before incrementing the lock_word </p>

</div>
</div>
<a class="anchor" id="a782d7ac356b97fee7edec4681dd22391"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="os0sync_8h.html#ae24909be432e4a95bd956a707e4d1d20">os_event_t</a> rw_lock_t::wait_ex_event</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Event for next-writer to wait on. A thread must decrement lock_word before waiting. </p>

</div>
</div>
<a class="anchor" id="a13331c41c505a694820ef9a5103cf331"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile ulint rw_lock_t::waiters</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>1: there are waiters </p>

</div>
</div>
<a class="anchor" id="ab641f9504e78011dc263e73c2435e166"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a> rw_lock_t::writer_is_wait_ex</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is TRUE if the writer field is RW_LOCK_WAIT_EX; this field is located far from the memory update hotspot fields which are at the start of this struct, thus we can peek this field without causing much memory bus traffic </p>

</div>
</div>
<a class="anchor" id="a09a9b8daf73c1c35f4d30632848df08b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="os0thread_8h.html#a0e87ca653f4358a387e610ee5c542f74">os_thread_id_t</a> rw_lock_t::writer_thread</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Thread id of writer thread. Is only guaranteed to have sane and non-stale value iff recursive flag is set. </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>include/<a class="el" href="sync0rw_8h_source.html">sync0rw.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 21 2015 19:14:28 for InnoDB Plugin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
