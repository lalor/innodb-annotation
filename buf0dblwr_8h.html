<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>InnoDB Plugin: include/buf0dblwr.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">InnoDB Plugin
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">buf0dblwr.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="univ_8i.html">univ.i</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ut0byte_8h_source.html">ut0byte.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log0log_8h_source.html">log0log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log0recv_8h_source.html">log0recv.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for buf0dblwr.h:</div>
<div class="dyncontent">
<div class="center"><img src="buf0dblwr_8h__incl.png" border="0" usemap="#include_2buf0dblwr_8h" alt=""/></div>
<map name="include_2buf0dblwr_8h" id="include_2buf0dblwr_8h">
<area shape="rect" id="node3" href="univ_8i.html" title="univ.i" alt="" coords="655,470,708,498"/><area shape="rect" id="node28" href="ut0byte_8h.html" title="ut0byte.h" alt="" coords="283,238,365,266"/><area shape="rect" id="node33" href="log0log_8h.html" title="log0log.h" alt="" coords="493,161,573,189"/><area shape="rect" id="node51" href="log0recv_8h.html" title="log0recv.h" alt="" coords="677,83,763,111"/><area shape="rect" id="node19" href="ut0dbg_8h.html" title="ut0dbg.h" alt="" coords="787,547,864,575"/><area shape="rect" id="node22" href="ut0ut_8h.html" title="ut0ut.h" alt="" coords="888,547,955,575"/><area shape="rect" id="node25" href="db0err_8h.html" title="db0err.h" alt="" coords="919,625,993,653"/><area shape="rect" id="node31" href="ut0byte_8ic.html" title="ut0byte.ic" alt="" coords="308,315,393,343"/><area shape="rect" id="node37" href="ut0lst_8h.html" title="ut0lst.h" alt="" coords="568,393,637,421"/><area shape="rect" id="node40" href="sync0sync_8h.html" title="sync0sync.h" alt="" coords="632,315,731,343"/><area shape="rect" id="node44" href="sync0rw_8h.html" title="sync0rw.h" alt="" coords="648,238,731,266"/><area shape="rect" id="node49" href="log0log_8ic.html" title="log0log.ic" alt="" coords="440,238,523,266"/><area shape="rect" id="node55" href="buf0types_8h.html" title="buf0types.h" alt="" coords="957,161,1053,189"/><area shape="rect" id="node57" href="hash0hash_8h.html" title="hash0hash.h" alt="" coords="716,161,820,189"/><area shape="rect" id="node65" href="log0recv_8ic.html" title="log0recv.ic" alt="" coords="907,393,995,421"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="buf0dblwr_8h__dep__incl.png" border="0" usemap="#include_2buf0dblwr_8hdep" alt=""/></div>
<map name="include_2buf0dblwr_8hdep" id="include_2buf0dblwr_8hdep">
<area shape="rect" id="node3" href="mtr0log_8ic.html" title="include/mtr0log.ic" alt="" coords="9,83,143,111"/><area shape="rect" id="node5" href="mtr0log_8h.html" title="include/mtr0log.h" alt="" coords="9,161,143,189"/></map>
</div>
</div>
<p><a href="buf0dblwr_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbuf__dblwr__t.html">buf_dblwr_t</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae04da9c9db457c394e73e851b4c6e9b9"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#ae04da9c9db457c394e73e851b4c6e9b9">buf_dblwr_create</a> (void)</td></tr>
<tr class="memitem:ad26efaa199ea803573631d5e3ffb7ad7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#ad26efaa199ea803573631d5e3ffb7ad7">buf_dblwr_init_or_load_pages</a> (<a class="el" href="os0file_8h.html#a63fac270d46d4a195e833a6672729041">os_file_t</a> file, char *path, bool load_corrupt_pages)</td></tr>
<tr class="memitem:a5353cb6d0c403c3345fba2c52618695c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a5353cb6d0c403c3345fba2c52618695c">buf_dblwr_process</a> (void)</td></tr>
<tr class="memitem:ab38a1ad857f80aedfedb20060def6560"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#ab38a1ad857f80aedfedb20060def6560">buf_dblwr_free</a> (void)</td></tr>
<tr class="memitem:aebaae47cdb7bef8e22f3e114f852890c"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#aebaae47cdb7bef8e22f3e114f852890c">buf_dblwr_update</a> (const <a class="el" href="structbuf__page__t.html">buf_page_t</a> *bpage, <a class="el" href="buf0types_8h.html#a7b34944f1921a4bf7c1a28abfb86d73c">buf_flush_t</a> flush_type)</td></tr>
<tr class="memitem:a58dec8fb6e33784d5b37f37a1d46fe47"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN <a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a58dec8fb6e33784d5b37f37a1d46fe47">buf_dblwr_page_inside</a> (ulint page_no)</td></tr>
<tr class="memitem:abd7745e181e732943f2149caad02e720"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#abd7745e181e732943f2149caad02e720">buf_dblwr_add_to_batch</a> (<a class="el" href="structbuf__page__t.html">buf_page_t</a> *bpage)</td></tr>
<tr class="memitem:aad42546734bec0119ef4bd40b93bf666"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#aad42546734bec0119ef4bd40b93bf666">buf_dblwr_flush_buffered_writes</a> (void)</td></tr>
<tr class="memitem:a73cf2f53e3e0581d5a538cbd492e27cf"><td class="memItemLeft" align="right" valign="top">UNIV_INTERN void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a73cf2f53e3e0581d5a538cbd492e27cf">buf_dblwr_write_single_page</a> (<a class="el" href="structbuf__page__t.html">buf_page_t</a> *bpage, bool sync)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9547ac40af85b7083c2c9fdcba791819"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structbuf__dblwr__t.html">buf_dblwr_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a9547ac40af85b7083c2c9fdcba791819">buf_dblwr</a></td></tr>
<tr class="memitem:a1f6f8b03f4b009365d8dba1648695867"><td class="memItemLeft" align="right" valign="top"><a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="buf0dblwr_8h.html#a1f6f8b03f4b009365d8dba1648695867">buf_dblwr_being_created</a></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Doublewrite buffer module</p>
<p>Created 2011/12/19 Inaam Rana </p>
</div><h2>Function Documentation</h2>
<a class="anchor" id="abd7745e181e732943f2149caad02e720"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_add_to_batch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuf__page__t.html">buf_page_t</a> *&#160;</td>
          <td class="paramname"><em>bpage</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Posts a buffer page for writing. If the doublewrite memory buffer is full, calls buf_dblwr_flush_buffered_writes and waits for for free space to appear. in: buffer block to write </p>

</div>
</div>
<a class="anchor" id="ae04da9c9db457c394e73e851b4c6e9b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_create </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates the doublewrite buffer to a new InnoDB installation. The header of the doublewrite buffer is placed on the trx system header page. </p>

</div>
</div>
<a class="anchor" id="aad42546734bec0119ef4bd40b93bf666"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_flush_buffered_writes </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flushes possible buffered writes from the doublewrite memory buffer to disk, and also wakes up the aio thread if simulated aio is used. It is very important to call this function after a batch of writes has been posted, and also when we may have to wait for a page latch! Otherwise a deadlock of threads can occur. </p>

</div>
</div>
<a class="anchor" id="ab38a1ad857f80aedfedb20060def6560"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_free </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>frees doublewrite buffer. </p>

</div>
</div>
<a class="anchor" id="ad26efaa199ea803573631d5e3ffb7ad7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buf_dblwr_init_or_load_pages </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="os0file_8h.html#a63fac270d46d4a195e833a6672729041">os_file_t</a>&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>load_corrupt_pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>At a database startup initializes the doublewrite buffer memory structure if we already have a doublewrite buffer created in the data files. If we are upgrading to an InnoDB version which supports multiple tablespaces, then this function performs the necessary update operations. If we are in a crash recovery, this function loads the pages from double write buffer into memory. </p>

</div>
</div>
<a class="anchor" id="a58dec8fb6e33784d5b37f37a1d46fe47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN <a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a> buf_dblwr_page_inside </td>
          <td>(</td>
          <td class="paramtype">ulint&#160;</td>
          <td class="paramname"><em>page_no</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determines if a page number is located inside the doublewrite buffer. </p>
<dl class="section return"><dt>Returns</dt><dd>TRUE if the location is inside the two blocks of the doublewrite buffer in: page number </dd></dl>

</div>
</div>
<a class="anchor" id="a5353cb6d0c403c3345fba2c52618695c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buf_dblwr_process </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Process the double write buffer pages. </p>

</div>
</div>
<a class="anchor" id="aebaae47cdb7bef8e22f3e114f852890c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structbuf__page__t.html">buf_page_t</a> *&#160;</td>
          <td class="paramname"><em>bpage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="buf0types_8h.html#a7b34944f1921a4bf7c1a28abfb86d73c">buf_flush_t</a>&#160;</td>
          <td class="paramname"><em>flush_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Updates the doublewrite buffer when an IO request is completed. in: flush type </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bpage</td><td>in: buffer block descriptor </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a73cf2f53e3e0581d5a538cbd492e27cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNIV_INTERN void buf_dblwr_write_single_page </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbuf__page__t.html">buf_page_t</a> *&#160;</td>
          <td class="paramname"><em>bpage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sync</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a page to the doublewrite buffer on disk, sync it, then write the page to the datafile and sync the datafile. This function is used for single page flushes. If all the buffers allocated for single page flushes in the doublewrite buffer are in use we wait here for one to become free. We are guaranteed that a slot will become free because any thread that is using a slot must also release the slot before leaving this function. in: true if sync IO requested </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bpage</td><td>in: buffer block to write </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2>Variable Documentation</h2>
<a class="anchor" id="a9547ac40af85b7083c2c9fdcba791819"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structbuf__dblwr__t.html">buf_dblwr_t</a>* buf_dblwr</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Doublewrite system </p>

</div>
</div>
<a class="anchor" id="a1f6f8b03f4b009365d8dba1648695867"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="univ_8i.html#ab71ee9e321c01cd32b9facc463e1c8d2">ibool</a> buf_dblwr_being_created</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set to TRUE when the doublewrite buffer is being created </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 21 2015 19:14:25 for InnoDB Plugin by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
